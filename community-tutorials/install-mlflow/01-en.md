---
title: Setup and usage of an MLFloe server
description: Learn how to setup an MLFlow server with basic auth
level: intermediate
updated_at: 2023-03-26
slug: setup-mlflow
author_name: Amjad Saadeh
author_url: https://github.com/amjadsaadeh/
author_image: -
author_bio: -
tags: [shell, ssh, linux] 
netcup_product_url: https://www.netcup.eu/bestellen/produkt.php?produkt=2948
language: en
available_languages: [de, en]
---

# Introduction
This tutorial aims to show how tp setup [MLFlow]() server for experiment tracking. Such a server is crucial for meaningful AI development and data science, since slight parameter changes may have a huge impact on the performance.
Having a central instance for storing such information is also beneficial with regard to collaborarion.
Additionally, MLFlow also provides basic visualization for tracked information, making it easy to compare models to each other.

Unfortunately, MLFlow does not provide any authentication feature. So this tutorial also covers setting up http basic authentication with nginx and to access the MLFlow instance from a python script.

# Requirements
A tracking server does not need much ressources, in opposition to training instances.
Therefor, a simple VPS, e.g. [VPS 200 G10s](https://www.netcup.de/bestellen/produkt.php?produkt=2948) should be enough at the moment.
In the long run more harddrive space may be necessary.
The main requirement for this tutorial is having linux server with a user with `sudo` rights.

# Step 1 - Ordering the VPS
For thus tutorial we are using the [VPS 200 G10s](https://www.netcup.de/bestellen/produkt.php?produkt=2948), but any VPS or root server should be usable.
After getting access to the serer, I provisioned it with the Ubuntu 22.04 LTS minimal image provided in the SCP. In addition, I enabled a custom user named `amjad` and "shh key only" login for this specific user during the setup (see screenshot underneath).

![provision_with_ssh_key.jpg]

# Step 2 - Install system dependencies
After provisioning the server should be ready for login with the provided user (`amjad` in this tutorial).
First of all we should run updates:

```bash
$ sudo apt-get update -y && sudo apt-get upgrade -y
```

After all updates are done, some applications need to be installed:
* `python3`: MLFlow is mainly written in python
* `pip`: python package manager
* `python3.10-venv`: for creating virtual environments
* `gcc`: compiler needed for some python packages later on
* `postgressql`: MLFlow provides different backends for storing the information. By default a .yaml file is used, but an SQL database is better, with regard to write and read performance, when the satabase grows.
* nginx: as reverse proxy to provide authentication

```bash
$ sudo apt-get install -y python3 python3-pip python3.10-venv postgresql nginx gcc
```

Typically, postgres and nginx service start automatically.

# Step 3 - Prepare database
Next we need to setup the database. This is done by the following commands:

```bash
$ sudo -u postgres psql
could not change directory to "/home/amjad": Permission denied
psql (14.7 (Ubuntu 14.7-0ubuntu0.22.04.1))
Type "help" for help.

postgres=# create database mlflow;
CREATE DATABASE
postgres=# create user mlflow with encrypted password 'airocks';
CREATE ROLE
postgres=# grant all privileges on database mlflow to mlflow;
GRANT
```

Here the password is `airocks`, please use a more secure one, when setting up your server.

# Step 4 - Install MLFlow itself
In this step we will install MLFlow itself.
We are going to install it in a virtual environment, to avoid interference with other applications:

```bash
$ python3 -m venv mlflow_venv
$ source mlflow_venv/bin/activate
(mlflow_venv) $ pip install mlflow psycopg2-binary
```

This will install a whole bunch of dependencies for MLFlow. 
The `psycopg2-binary` package is required for the connection to the postgres database.
To check whether the installation was successful you can run the following command:

```bash
(mlflow_venv) $ mlflow --version
mlflow, version 2.2.2
```

Please take care that you need to activate the virtual environment before running any `mlflow` command.

Next we take care about the directories for log files and artifacts, since they are not stored in the database:

```bash
(mlflow_venv) $ mkdir -p ~/mlflow/mlruns # artifact dir
(mlflow_venv) $ mkdir -p ~/mlflow/mllogs # logs dir
```

To test runability we will start the MLFlow server in a "free-to-all" manner on port 8000:

```bash
(mlflow_venv) $ mlflow server --backend-store-uri postgresql://mlflow:airocks@localhost/mlflow --default-artifact-root ~/mlflow/mlruns--serve-artifacts -h 0.0.0.0 -p 8000
2023/03/22 14:23:32 INFO mlflow.store.db.utils: Creating initial MLflow database tables...
2023/03/22 14:23:32 INFO mlflow.store.db.utils: Updating database tables
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -> 451aebb31d03, add metric step
INFO  [alembic.runtime.migration] Running upgrade 451aebb31d03 -> 90e64c465722, migrate user column to tags
INFO  [alembic.runtime.migration] Running upgrade 90e64c465722 -> 181f10493468, allow nulls for metric values
INFO  [alembic.runtime.migration] Running upgrade 181f10493468 -> df50e92ffc5e, Add Experiment Tags Table
INFO  [alembic.runtime.migration] Running upgrade df50e92ffc5e -> 7ac759974ad8, Update run tags with larger limit
INFO  [alembic.runtime.migration] Running upgrade 7ac759974ad8 -> 89d4b8295536, create latest metrics table
INFO  [89d4b8295536_create_latest_metrics_table_py] Migration complete!
INFO  [alembic.runtime.migration] Running upgrade 89d4b8295536 -> 2b4d017a5e9b, add model registry tables to db
INFO  [2b4d017a5e9b_add_model_registry_tables_to_db_py] Adding registered_models and model_versions tables to database.
INFO  [2b4d017a5e9b_add_model_registry_tables_to_db_py] Migration complete!
INFO  [alembic.runtime.migration] Running upgrade 2b4d017a5e9b -> cfd24bdc0731, Update run status constraint with killed
INFO  [alembic.runtime.migration] Running upgrade cfd24bdc0731 -> 0a8213491aaa, drop_duplicate_killed_constraint
INFO  [alembic.runtime.migration] Running upgrade 0a8213491aaa -> 728d730b5ebd, add registered model tags table
INFO  [alembic.runtime.migration] Running upgrade 728d730b5ebd -> 27a6a02d2cf1, add model version tags table
INFO  [alembic.runtime.migration] Running upgrade 27a6a02d2cf1 -> 84291f40a231, add run_link to model_version
INFO  [alembic.runtime.migration] Running upgrade 84291f40a231 -> a8c4a736bde6, allow nulls for run_id
INFO  [alembic.runtime.migration] Running upgrade a8c4a736bde6 -> 39d1c3be5f05, add_is_nan_constraint_for_metrics_tables_if_necessary
INFO  [alembic.runtime.migration] Running upgrade 39d1c3be5f05 -> c48cb773bb87, reset_default_value_for_is_nan_in_metrics_table_for_mysql
INFO  [alembic.runtime.migration] Running upgrade c48cb773bb87 -> bd07f7e963c5, create index on run_uuid
INFO  [alembic.runtime.migration] Running upgrade bd07f7e963c5 -> 0c779009ac13, add deleted_time field to runs table
INFO  [alembic.runtime.migration] Running upgrade 0c779009ac13 -> cc1f77228345, change param value length to 500
INFO  [alembic.runtime.migration] Running upgrade cc1f77228345 -> 97727af70f4d, Add creation_time and last_update_time to experiments table
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
2023/03/22 14:23:32 INFO mlflow.store.db.utils: Creating initial MLflow database tables...
2023/03/22 14:23:32 INFO mlflow.store.db.utils: Updating database tables
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
[2023-03-22 14:23:32 +0100] [23838] [INFO] Starting gunicorn 20.1.0
[2023-03-22 14:23:32 +0100] [23838] [INFO] Listening at: http://0.0.0.0:8000 (23838)
[2023-03-22 14:23:32 +0100] [23838] [INFO] Using worker: sync
[2023-03-22 14:23:32 +0100] [23839] [INFO] Booting worker with pid: 23839
[2023-03-22 14:23:32 +0100] [23840] [INFO] Booting worker with pid: 23840
[2023-03-22 14:23:32 +0100] [23841] [INFO] Booting worker with pid: 23841
[2023-03-22 14:23:32 +0100] [23842] [INFO] Booting worker with pid: 23842
[2023-03-22 14:23:44 +0100] [23838] [INFO] Handling signal: winch
[2023-03-22 14:23:44 +0100] [23838] [INFO] Handling signal: winch
[2023-03-22 14:23:44 +0100] [23838] [INFO] Handling signal: winch
```

Now you should be able to see the webui in a browser by putting the ip address or the proper domain name in the address line, appended by an `:8000` for the port.

![first_impression_webui.jpg]

You may see almost nothing, but this will change later on, when we run a few experiments and track them to this instance.
At the moment kill the process with `ctrl+c` to avoid security issues.
Additionally, MLFlow would currently not automatically start on server restart.

# Step 5 - Use as jump server
To access other servers whose SSH daemon is bound only to port 22 (or another), use the command:

`ssh -J root@v11111111.quicksrv.de:443 root@myserver.com`

Replace our example `v11111111.quicksrv.de` with the correct proxy server name. Instead of `myserver.com` you must specify the server to which you want to connect through the proxy.

![The jump host will forward a connection](community-tutorials/setup-and-use-sshproxy/images/jump.png)

# Conclusion
SSH proxy can now be used. It is recommended to perform tests before productive use.

![The SOCKS proxy can handle multiple ports simultaneously](community-tutorials/setup-and-use-sshproxy/images/socks.png)

# Licence

[MIT](https://github.com/netcup-community/community-tutorials/blob/main/LICENSE)

Copyright (c) 2021 netcup

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicence, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

# Contributor's Certificate of Origin
By making a contribution to this project, I certify that:

 1) The contribution was created in whole or in part by me and I have the right to submit it under the licence indicated in the file; or

 2) The contribution is based upon previous work that, to the best of my knowledge, is covered under an appropriate licence and I have the right under that licence to submit that work with modifications, whether created in whole or in part by me, under the same licence (unless I am permitted to submit under a different licence), as indicated in the file; or

 3) The contribution was provided directly to me by some other person who certified (a), (b) or (c) and I have not modified it.

 4) I understand and agree that this project and the contribution are public and that a record of the contribution (including all personal information I submit with it, including my sign-off) is maintained indefinitely and may be redistributed consistent with this project or the licence(s) involved.
