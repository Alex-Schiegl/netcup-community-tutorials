---
title: zRam Tutorial
description: How to use zRam for compressing data into RAM
updated_at: 2021-11-08
slug: zram-tutorial
author_name: Marcel Pabst
author_url: -
author_image: -
author_bio: -
tags: [debian, ubuntu, ram, vserver, rootserver, swap, zram]
netcup_product_url: https://www.netcup.de/vserver/vps.php
language: en
available_languages: en
---

# Introduction
Especially on systems with little RAM, it may happen from time to time that the available memory will become scarce and the system will start to use the swap memory. Since this is typically located on the hard drive, it is relatively slow compared to RAM and thus may impact the systems performance.

A remedy is provided by a technology integrated in the Linux kernel called zRam. It creates a compressing block device directly in the computer's RAM. The kernel first occupies the available RAM and then tries to compress parts of it into zRam. It effectively only moves data within the RAM which is magnitudes faster than swapping to disk. This technique therefore allows more data to be accommodated in memory. Practically, this results in the system not having to swap to a slower hard disk as quickly. The price is a slightly increased processor load which usually has a much smaller impact than swapping on disk.

The installation is quite simple but can make a big impact on the performance of your server if memory is tight.

NOTE: This guide is using zram-tools 0.3.3.1-1

# Requirements
This tutorial should be adaptable to most Linux Distros as this is a kernel function. However the activation of the feature/the installation of the package may be different. I want to keep it related to Ubuntu and Debian here to keep it short and meaningful. So all you need is a vServer or Root Server from Netcup with Ubuntu or Debian installed and a user with root access.

# Step 1 - Installing zram-tools
```
sudo apt install zram-tools
```
# Step 2 - Adjust the configuration
Edit the configuration file with your favourite text editor e.g. `sudo vim /etc/default/zramswap`:
```
# EXAMPLE Configuration
# Adjust to your needs
#
# Compression algorithm selection
# speed: lz4 > zstd > lzo
# compression: zstd > lzo > lz4
# This is not inclusive of all that is available in latest kernels
# See /sys/block/zram0/comp_algorithm (when zram module is loaded) to see
# what is currently set and available for your kernel[1]
# [1]  https://github.com/torvalds/linux/blob/master/Documentation/blockdev/zram.txt#L86
#ALGO=lz4

# Specifies the amount of RAM that should be used for zram
# based on a percentage the total amount of available memory
# This takes precedence and overrides SIZE below
#PERCENT=50

# Specifies a static amount of RAM that should be used for
# the ZRAM devices, this is in MiB
SIZE=4096

# Specifies the priority for the swap devices, see swapon(2)
# for more details. Higher number = higher priority
# This should probably be higher than hdd/ssd swaps.
#PRIORITY=100
```
You can select the compression algorithm via the ALGO variable. While lz4 is the fastest algorithm it is also the one with the lowest compression. In general: More compression means slower compression/more computations neccessary. So the compression algorithm needs to be chosen according to your CPU performance.

We can then tell zRam how much of our RAM should be used. This can either be a percentage of the total amount of available memory (PERCENT) or a fixed value (SIZE). In the example we decided to use a fixed amount of 4096 MiB of RAM. 

PRIORITY sets the priority for the swap device. You normally want to use zRam as the first swap device which is used, so we keep this at 100 (which is the highest priority). 

# Step 3 - Reboot
There are various methods to reboot your system. Here is one which works from your terminal:
```
sudo reboot
```

# Step 4 - Check your configuration
Now you should be able to see your zRam SWAP by typing `sudo swapon -s` which will show an output like this:
```
Filename                                Type            Size    Used    Priority
/swapfile                               file            4194300 0       -2
/dev/zram0                              partition       4194300 0       100
```
We see that we have a "standard" swap file `/swapfile` which is located on our actual harddrive (this is the one we only want to use if we have no other option) and we have our zRam partition `/dev/zram0` with the specified size. You can also see how much zRam is currently used as well as the priorities of the swap devices.

You can also use `/usr/sbin/zramctl` to show more specific information about your zram device:
```
NAME       ALGORITHM DISKSIZE DATA COMPR TOTAL STREAMS MOUNTPOINT
/dev/zram0 lz4             4G   4K   64B    4K       4 [SWAP]
```

# Conclusion
Congratulations! You have successfully installed and configured zRam to make better use of your systems ressources. 

If you'd like to further tweak how your zRam (swap) is used you should take a look at the `/etc/sysctl.conf` where you can configure your swappiness, cache pressure etc.
```
# SYSCTL ZRAM EXAMPLE Configuration
vm.vfs_cache_pressure=500
vm.swappiness=100
vm.dirty_background_ratio=1
vm.dirty_ratio=50
```
This configuration would work good on systems with low memory. We start swapping early (as we do want to use our zRam as early as possible) and set a high cache pressure to keep memory consumption lower on the long term. For a full explanation of the settings take a look here: [https://www.kernel.org/doc/Documentation/sysctl/vm.txt](https://www.kernel.org/doc/Documentation/sysctl/vm.txt)

# License
MIT

# Contributor's Certificate of Origin
Contributor's Certificate of Origin By making a contribution to this project, I certify that:

 1) The contribution was created in whole or in part by me and I have the right to submit it under the license indicated in the file; or

 2) The contribution is based upon previous work that, to the best of my knowledge, is covered under an appropriate license and I have the right under that license to submit that work with modifications, whether created in whole or in part by me, under the same license (unless I am permitted to submit under a different license), as indicated in the file; or

 3) The contribution was provided directly to me by some other person who certified (a), (b) or (c) and I have not modified it.

 4) I understand and agree that this project and the contribution are public and that a record of the contribution (including all personal information I submit with it, including my sign-off) is maintained indefinitely and may be redistributed consistent with this project or the license(s) involved.

Signed-off-by: Marcel Pabst [pabstmarcel95@gmail.com](mailto:pabstmarcel95@gmail.com)

