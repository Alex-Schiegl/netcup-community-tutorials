---
title: Setup WireGuard® on a Ubuntu server
description: How to setup WireGuard® on a Ubuntu server
updated_at: 2021-11-04
slug: how-to-setup-wireguard-ubuntu
author_name: Florian Gareis
author_url: https://gareis.io
author_image: https://zkr.io/avatar.jpg
author_bio:
tags: wireguard, wg, vpn, ubuntu
netcup_product_url: https://www.netcup.de/bestellen/produkt.php?produkt=2000
language: en
available_languages: en
---

# Introduction
In this tutorial, we'll have a look at how to setup WireGuard® on a freshly installed Ubuntu server. In this case, we use the smallest available Netcup VPS, since it has more then enough power for our little WireGuard® server. 
But first let's clarify what WireGuard® is (quote from the WireGuard® website):
> WireGuard® is an extremely simple yet fast and modern VPN that utilizes state-of-the-art cryptography. 

In this tutorial we focus on a simple setup with one server and one client peer. 

# Requirements
- A server (root or VPS)
- Ubuntu as an operating system (debian would also work)

# Step 1 - Install WireGuard®

First we need to install WireGuard® on our new server. For Ubuntu this is quite easy:

```bash
sudo apt install wireguard
```

# Step 2 - Generate keys

WireGuard® works with private and public keys. For every client, we need one private and one public key. WireGuard® treats the server itself as a client as well, so we also need private/public keys for the server.

To generate these keys, we can use the following command:
```bash
wg genkey | tee server-private.key | wg pubkey > server-public.key
wg genkey | tee client-private.key | wg pubkey > client-public.key
```

We now have a private/public key for the server and a private/public key for one client. 

# Step 3 - Configuration of the WireGuard® server

To configure the WireGuard® server, we need to edit the following file:
```bash
sudo nano /etc/wireguard/wg0.conf
```

The content of this file should look like this:
```conf
[Interface]
Address = 10.0.0.1/24
PrivateKey = <server-private.key>
ListenPort = 51820
SaveConfig = true
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
PublicKey = <client-public.key>
AllowedIPs = 10.0.0.2/32
```

- `Address` will set the internal IP address range of the WireGuard® network
- `PrivateKey` should be the `server-private.key` we generated earlier
- `ListenPort` defines the port of the WireGuard® server
- `SaveConfig` defines, if the current config should be saved, when the service is stopped
- `PostUp` ensures, that the firewall will not block the connection, when the WireGuard® server is started
- `PostDown` removes the firewall rules, once the WireGuard® service is stopped
- For every client in the network, one `[Peer]` element should be created within this file (therefore only one in our example)
- `PublicKey` should contain the `client-public.key`, we generated earlier
- `AllowedIPs` defines all IPs that this peer is allowed to have when connected to the network

## Step 3.1 - Set IP forwarding

We also need to set IP V4 forwarding, in order to make WireGuard® work on our Ubuntu Netcup server:
```diff
sudo nano /etc/sysctl.conf
- #net.ipv4.ip_forward=1
+ net.ipv4.ip_forward=1
```

# Step 4 - Configure client

Next to the sever, we also need to configure our client.
Since within WireGuard® the client and the server are just a peer in the network and therefore treat equal, the config file for the client looks very similar, but without some specific server options:
```conf
[Interface]
PrivateKey = <client-private.key>
Address = 10.0.0.2/32
DNS = 1.1.1.1

[Peer]
PublicKey = <server-public.key>
AllowedIPs = 10.0.0.1/32
Endpoint = <server-ip>:51820
```

- `PrivateKey` should be the previous generated `client-private.key`
- `Address` the address of this peer within the network. Should be unique
- `DNS` sets a custom DNS server (in this example the cloudflare server)
- `Peer` should contain the information about the WireGuard® server
- `PublicKey` should be the previous generated `server-public.key`
- `AllowedIPs` should be the internal IP of the server
- `Endpoint` the IP and the port, where the client should connect to

# Step 5 - Delete the previous generated keys

Since we now inserted our generated keys into the config files, we can safly delete them:
```bash
rm server-public.key server-private.key client-public.key client-private.key
```

# Step 6 - Autostart WireGuard®

Usually we want to autostart WireGuard®, if our server is started. 
For that we can run the following commands:
```bash
sudo wg-quick up wg0
sudo systemctl enable wg-quick@wg0
```

# Conclusion

Compared to other services like OpenVPN, WireGuard® is much smaller, cleaner and therefore also faster.
No wonder, even Linux founder Linus Torvalds is [very supportive](https://lists.openwall.net/netdev/2018/08/02/124) of this project.
It is a great way of securing a connection when connected to a public wifi for example. 

For more information, please visit the [WireGuard® website](https://www.wireguard.com/).

# License
MIT

# Contributor's Certificate of Origin
Contributor's Certificate of Origin By making a contribution to this project, I certify that:

 1) The contribution was created in whole or in part by me and I have the right to submit it under the license indicated in the file; or

 2) The contribution is based upon previous work that, to the best of my knowledge, is covered under an appropriate license and I have the right under that license to submit that work with modifications, whether created in whole or in part by me, under the same license (unless I am permitted to submit under a different license), as indicated in the file; or

 3) The contribution was provided directly to me by some other person who certified (a), (b) or (c) and I have not modified it.

 4) I understand and agree that this project and the contribution are public and that a record of the contribution (including all personal information I submit with it, including my sign-off) is maintained indefinitely and may be redistributed consistent with this project or the license(s) involved.

Signed-off-by: Florian Gareis <dev@zoker.me>
